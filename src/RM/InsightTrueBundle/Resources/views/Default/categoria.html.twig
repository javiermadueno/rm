{% extends '::insight/base_insight.html.twig' %}
{% block title %}

 {% trans %}Categor&iacute;as{% endtrans %}
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/datepicker.css') }}" rel="stylesheet" />
    <script src="{{ asset('js/datepicker/jquery-datepicker.js') }}" ></script>
	<script src="{{ asset('js/datepicker/jquery.ui.datepicker-es.js') }}"></script>
	<script src="/Symfony/vendor/ob/highcharts-bundle/Ob/HighchartsBundle/Resources/public/js/highcharts/highcharts.js"></script>
	<script src="/Symfony/vendor/ob/highcharts-bundle/Ob/HighchartsBundle/Resources/public/js/highcharts/modules/exporting.js"></script>
{% endblock %}

{% block migas %}
	<p> 
		<span class="ml1">{% trans %}Insight>{% endtrans %}</span> > <span class="mlN">{% trans %}Dashboard{% endtrans %}</span>
	</p>
{% endblock %}

{% block contenedorPrincipal %}

    
    <div class="bloque_contenido">
						
		<div class="cabecera_contenido">
			<span>{% trans %}Clientes{% endtrans %}</span> 
		</div>
		<div class="bloque_contenido sinborde">
			<div class="linea_contenido">
			<label>{% trans %}Fecha:&nbsp;&nbsp;{% endtrans %}</label>
			<select id="id_categoria" name="id_categoria" class="tam6 izq actualizarTabla">
					<option value="-1">{% trans %}Seleccione{% endtrans %}</option>
					<option value="1" >{% trans %}Ene-2014{% endtrans %}</option>
					<option value="2" >{% trans %}Feb-2014{% endtrans %}</option>
					<option value="3" >{% trans %}Mar-2014{% endtrans %}</option>
					<option value="4" >{% trans %}Abr-2014{% endtrans %}</option>
					<option value="5" >{% trans %}May-2014{% endtrans %}</option>
					<option value="6" >{% trans %}Jun-2014{% endtrans %}</option>
					<option value="7" >{% trans %}Jul-2014{% endtrans %}</option>					
					<option value="8" selected>{% trans %}Ago-2014{% endtrans %}</option>
					<option value="9" >{% trans %}Sep-2014{% endtrans %}</option>
					<option value="10" >{% trans %}Oct-2014{% endtrans %}</option>
					<option value="11" >{% trans %}Nov-2014{% endtrans %}</option>
					<option value="12" >{% trans %}Dic-2014{% endtrans %}</option>
				</select>
				<label>{% trans %}&nbsp;&nbsp;Categoria 1:&nbsp;&nbsp;{% endtrans %}</label>
				<select id="fecha_from" name="fecha_from" class="tam6 izq actualizarTabla">
					<option value="-1">{% trans %}Seleccione{% endtrans %}</option>
					<option value="1" >{% trans %}Alimentacion Seca{% endtrans %}</option>
					<option value="2" selected>{% trans %}Frescos{% endtrans %}</option>
					<option value="3" >{% trans %}Consumibles{% endtrans %}</option>
					<option value="4" >{% trans %}No Alimentacion{% endtrans %}</option>
					<option value="5" >{% trans %}Refrigerados{% endtrans %}</option>
					<option value="6" >{% trans %}Servicios{% endtrans %}</option>
					<option value="7" >{% trans %}Socio-Cliente{% endtrans %}</option>					
				</select>
{# 				<label>{% trans %}&nbsp;&nbsp;Categoria 2:&nbsp;&nbsp;{% endtrans %}</label>#}
{# 				<select id="id_fecha_to" name="fecha_to" class="tam6 izq actualizarTabla">#}
{# 					<option value="-1">{% trans %}Seleccione{% endtrans %}</option>#}
{# 					<option value="1" >{% trans %}Alimentacion Seca{% endtrans %}</option>#}
{# 					<option value="2" Selected>{% trans %}Frescos{% endtrans %}</option>#}
{# 					<option value="3" >{% trans %}Consumibles{% endtrans %}</option>#}
{# 					<option value="4" >{% trans %}No Alimentacion{% endtrans %}</option>#}
{# 					<option value="5" >{% trans %}Refrigerados{% endtrans %}</option>#}
{# 					<option value="6" >{% trans %}Servicios{% endtrans %}</option>#}
{# 					<option value="7" >{% trans %}Socio-Cliente{% endtrans %}</option>	#}
{# 				</select>#}
				<label>{% trans %}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Marca&nbsp;&nbsp;{% endtrans %}</label>
				<select id="id_marca" name="id_marca" class="tam6 izq actualizarTabla">
					<option value="-1">{% trans %}Seleccione{% endtrans %}</option>
					<option value="1" >{% trans %}Chambourcy{% endtrans %}</option>
					<option value="2" selected>{% trans %}El Pozo{% endtrans %}</option>
					<option value="3" >{% trans %}Campofrio{% endtrans %}</option>
					<option value="4" >{% trans %}Purina{% endtrans %}</option>
				</select>
			</div>
			<div class="bloque_contenido sinborde">			
				<table class="tablaSinBordes">
					<tbody>
						<tr>
							<td colspan="2" align="center">
							<div>
								<table class="tablaSinBordes">
									<tbody>
										<thead>
											<tr>
												<th style="text-align: center; width:auto;">{% trans %}&nbsp;{% endtrans %}</th>
												<th style="text-align: center; width:auto;">{% trans %}Per&iacute;odo{% endtrans %}</th>
												<th style="text-align: center; width:auto;">{% trans %}Categor&iacute;a{% endtrans %}</th>
												<th style="text-align: center; width:auto;">{% trans %}Media{% endtrans %}</th>
												<th style="text-align: center; width:auto;">{% trans %}Evoluci&oacute;n{% endtrans %}</th>
											</tr>
										</thead>
										{% for dato in dataTable %}
										<tr>
											<td style="text-align: center; border-bottom-style: solid; border-bottom: 2px;"   rowspan="2">
												{% if dato[0] == 'Redencion' %}
													{% trans %}Redenci&oacute;n{% endtrans %}										
												{% elseif dato[0] == 'Campaï¿½as' %}
													{% trans %}Campa&ntilde;as{% endtrans %}
												{% else %}
													{{ dato[0] }}
												{% endif %}													
											</td>
											<td style="text-align: center;">
												{% trans %}Acumulado a&ntilde;o{% endtrans %}
											</td>
											<td style="text-align: center;">
												{{ dato[2] }}
											</td>
											<td style="text-align: center;">
												{{  dato[3] }}
											</td>
											{% if dato[4] > 0 %}
												<td style="text-align: center;" width="20%">
													{% if dato[4]|length == 3 %}
														{{ dato[4] }}{% trans %}%&nbsp;{% endtrans %}<img src="{{ asset('img/arrowup.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% else %}
														{{ dato[4] }}{% trans %}%&nbsp;&nbsp;{% endtrans %}<img src="{{ asset('img/arrowup.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% endif %}	
												</td>
											{% elseif dato[4] < 0 %}
												<td style="text-align: center;" width="20%">
													{% if dato[4]|length == 3 %}
														{{ dato[4] }}{% trans %}%&nbsp;{% endtrans %}<img src="{{ asset('img/arrowdown.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% else %}
														{{ dato[4] }}{% trans %}%&nbsp;&nbsp;{% endtrans %}<img src="{{ asset('img/arrowup.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% endif %}		
												</td>
											{% else %}
												<td style="text-align: center;" width="20%">
													{{ dato[4] }}{% trans %}%{% endtrans %}
												</td>
											{% endif %}																							
										</tr>
										<tr>
											<td style="text-align: center; background-color: graytext;">
												{{ dato[5] }}
											</td>
											<td style="text-align: center; background-color: graytext;">
												{{ dato[6] }}
											</td>
											<td style="text-align: center; background-color: graytext;">
												{{ dato[7] }}
											</td>
											{% if dato[8] > 0 %}
												<td style="text-align: center; background-color: graytext;" width="20%">
													{% if dato[8]|length == 3 %}
														{{ dato[8] }}{% trans %}%&nbsp;{% endtrans %}<img src="{{ asset('img/arrowup.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% else %}
														{{ dato[8] }}{% trans %}%&nbsp;&nbsp;{% endtrans %}<img src="{{ asset('img/arrowup.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% endif %}	
												</td>
											{% elseif dato[8] < 0 %}
												<td style="text-align: center; background-color: graytext;" width="20%">
													{% if dato[8]|length == 3 %}
														{{ dato[8] }}{% trans %}%&nbsp;{% endtrans %}<img src="{{ asset('img/arrowdown.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% else %}
														{{ dato[8] }}{% trans %}%&nbsp;&nbsp;{% endtrans %}<img src="{{ asset('img/arrowup.png') }}" alt="{{ 'Proyeccion' | trans }}"title="{{ 'Proyeccion' | trans }}" />
													{% endif %}		
												</td>
											{% else %}
												<td style="text-align: center; background-color: graytext;" width="20%">
													{{ dato[8] }}{% trans %}%{% endtrans %}
												</td>
											{% endif %}															
										</tr>
										<tr>
											<td>&nbsp;</td>
										</tr>
										{% endfor %}										
									</tbody>
									</table>
								</div>
							</td>
						</tr>
						<tr>
							<td width="50%" class="graficoIzquierda" align="center">
								<div id="graficoVentasMes" style="height: 300px; margin: 0 auto" width="50%"></div>
							</td>
							<td width="50%" class="graficoDerecha" align="center">
								<div id="graficoRecenciaAnual" style="height: 300px; margin: 0 auto"></div>
							</td>
						</tr>
						<tr>
							<td colspan="2" width="100%" align="center">
								<div id="tablaNuevosMiembros" style="height: 150px; margin: 0 auto">
								<table>
								<thead>
									<tr>
										<th colspan="8" style="text-align: center;">
											{% trans %}Desglose{% endtrans %}
										</th>
									</tr>
									<tr>
										<th style="text-align: center;">{% trans %}Subcategor&iacute;a{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}Ventas{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}% Categor&iacute;a{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}% Total{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}Evoluci&oacute;n{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}Comparaci&oacute;n{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}Impactos{% endtrans %}</th>
										<th style="text-align: center;">{% trans %}Redenci&oacute;n{% endtrans %}</th>
									</tr>
								</thead>
									{% for d in data %}
									<tr>
										<td style="text-align: center;" width="12.5%">
											{{ d[0] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[1] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[2] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[3] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[4] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[5] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[6] }}
										</td>
										<td style="text-align: center;" width="12.5%">
											{{ d[7] }}
										</td>
									</tr>
									{% endfor %}
								</table>
								</div>
							</td>
						</tr>
						<tr>
							<td width="50%" class="graficoIzquierda" align="center">
								<div id="grafico1" style="height: 300px; margin: 0 auto" width="50%"></div>
							</td>
							<td width="50%" class="graficoDerecha" align="center">
								<div id="graficoImpactosMensuales" style="height: 300px; margin: 0 auto"></div>
							</td>
						</tr>
						<tr>
							<td width="50%" class="graficoIzquierda" align="center">
								<div id="graficoEdades" style="height: 300px; margin: 0 auto" width="50%"></div>
							</td>
							<td width="50%" class="graficoDerecha" align="center">
								<div id="graficoSexos" style="height: 300px; margin: 0 auto"></div>
							</td>
						</tr>
						<tr>
							<td>
								{% trans %}&nbsp;{% endtrans %}
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
{% endblock %}
{% block javascripts %}
	{{ parent() }}
	<script type="text/javascript">
	$(function() {
		$('.date-picker').datepicker( {
		    changeMonth: true,
		    changeYear: true,
		    showButtonPanel: true,
		    dateFormat: 'MM yy',
		    onClose: function(dateText, inst) { 
		        var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
		        var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
		        $(this).datepicker('setDate', new Date(year, month, 1));
		    }
		});
		});



	
	$(function () {
	    $('#graficoVentasMes').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: 'Ventas Mensuales por Categoria'
	        },
	        subtitle: {
	            text: ''
	        },
	        xAxis: {
	            categories: [
	                'Frescos'
	            ]
	        },
	        yAxis: {
	            min: 0,
	            title: {
	                text: 'Ventas (Euros)'
	            }
	        },
	        tooltip: {
	            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
	            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
	                '<td style="padding:0"><b>{point.y} Euros</b></td></tr>',
	            footerFormat: '</table>',
	            shared: true,
	            useHTML: true
	        },
	        plotOptions: {
	            column: {
	                pointPadding: 0.2,
	                borderWidth: 0
	            }
	        },
	        series: [{
	            name: 'Ago-13',
	            data: [4805],
            	color: '#B40431'

	        }, {
	            name: 'Ago-14',
	            data: [3581],
	            color: '#D7DF01'
	        }]
	    });

	    $('#graficoRecenciaAnual').highcharts({
	        title: {
	            text: 'Recencia Anual',
	            x: -20 //center
	        },
	        subtitle: {
	            text: 'Frescos',
	            x: -20
	        },
	        xAxis: {
	            categories: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
	                'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic']
	        },
	        yAxis: {
	            title: {
	                text: 'Recencia (%)'
	            },
	            plotLines: [{
	                value: 0,
	                width: 1,
	                color: '#808080'
	            }]
	        },
	        tooltip: {
	            valueSuffix: '%'
	        },
	        legend: {
	            layout: 'vertical',
	            align: 'right',
	            verticalAlign: 'middle',
	            borderWidth: 0
	        },
	        series: [{
	            name: '2013',
	            data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
	        }, {
	            name: '2014',
	            data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6]
	        }]
	    });

	    $('#graficoImpactosMensuales').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: 'Clientes de la Categoria {{ categoria }} por Nivel de Fidelizacion'
	        },
	        subtitle: {
	            text: '{{ categoria }}'
	        },
	        xAxis: {
	            categories: ['Compra', 'Media']
	        },
	        yAxis: {
	            min: 0,
	            title: {
	                text: 'Compras'
	            },
	            stackLabels: {
	                enabled: true,
	                style: {
	                    fontWeight: 'bold',
	                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
	                }
	            }
	        },
	        legend: {
	            align: 'right',
	            x: -70,
	            verticalAlign: 'top',
	            y: 20,
	            floating: true,
	            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
	            borderColor: '#CCC',
	            borderWidth: 1,
	            shadow: false
	        },
	        tooltip: {
	            formatter: function () {
	                return '<b>' + this.x + '</b><br/>' +
	                    this.series.name + ': ' + this.y + '<br/>' +
	                    'Total: ' + this.point.stackTotal;
	            }
	        },
	        plotOptions: {
	            column: {
	                stacking: 'normal',
	                dataLabels: {
	                    enabled: true,
	                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
	                    style: {
	                        textShadow: '0 0 3px black, 0 0 3px black'
	                    }
	                }
	            }
	        },
	        series: [{
	            name: 'Ocasionales',
	            data: [16, 20]
	        }, {
	            name: 'Habituales',
	            data: [29, 33]
	        }, {
	            name: 'Frecuentes',
	            data: [35, 26]
	        }, {
	            name: 'Ocasionales',
	            data: [20, 21]
	        }]
	    	    });

	    $('#grafico1').highcharts({
	    	chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false
            },
            title: {
                text: 'Clientes nuevos por Categoria'
            },
	        subtitle: {
	            text: '{{ categoria }}'
	        },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true
                    },
                    showInLegend: true
                }
            },
	        series: [{
	            type: 'pie',
	            name: 'Porcentaje',
	            data: [
	                ['Oro',    3.5],
	                ['Plata',     6.2],
	                ['Bronce',   8.4]
	            ]
	        }]
	    });

	    $('#graficoEdades').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: 'Clientes de la Categoria {{ categoria }} por Edades'
	        },
	        xAxis: {
	            categories: ['Compra', 'Media']
	        },
	        yAxis: {
	            min: 0,
	            title: {
	                text: 'Compras'
	            },
	            stackLabels: {
	                enabled: true,
	                style: {
	                    fontWeight: 'bold',
	                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
	                }
	            }
	        },
	        legend: {
	            align: 'right',
	            x: -70,
	            verticalAlign: 'top',
	            y: 20,
	            floating: true,
	            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
	            borderColor: '#CCC',
	            borderWidth: 1,
	            shadow: false
	        },
	        tooltip: {
	            formatter: function () {
	                return '<b>' + this.x + '</b><br/>' +
	                    this.series.name + ': ' + this.y + '<br/>' +
	                    'Total: ' + this.point.stackTotal;
	            }
	        },
	        plotOptions: {
	            column: {
	                stacking: 'normal',
	                dataLabels: {
	                    enabled: true,
	                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
	                    style: {
	                        textShadow: '0 0 3px black, 0 0 3px black'
	                    }
	                }
	            }
	        },
	        series: [{
	            name: '18-25',
	            data: [15, 18]
	        }, {
	            name: '25-40',
	            data: [28, 30]
	        }, {
	            name: '40-55',
	            data: [35, 25]
	        }, {
	            name: '55-65',
	            data: [18, 19]
	        }, {
	            name: '>65',
	            data: [4, 8]
	        }]
	    });

	    $('#graficoSexos').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: 'Clientes de la Categoria {{ categoria }} por Sexos'
	        },
	        xAxis: {
	            categories: ['Compra', 'Media']
	        },
	        yAxis: {
	            min: 0,
	            title: {
	                text: 'Compras'
	            },
	            stackLabels: {
	                enabled: true,
	                style: {
	                    fontWeight: 'bold',
	                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
	                }
	            }
	        },
	        legend: {
	            align: 'right',
	            x: -70,
	            verticalAlign: 'top',
	            y: 20,
	            floating: true,
	            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
	            borderColor: '#CCC',
	            borderWidth: 1,
	            shadow: false
	        },
	        tooltip: {
	            formatter: function () {
	                return '<b>' + this.x + '</b><br/>' +
	                    this.series.name + ': ' + this.y + '<br/>' +
	                    'Total: ' + this.point.stackTotal;
	            }
	        },
	        plotOptions: {
	            column: {
	                stacking: 'normal',
	                dataLabels: {
	                    enabled: true,
	                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
	                    style: {
	                        textShadow: '0 0 3px black, 0 0 3px black'
	                    }
	                }
	            }
	        },
	        series: [{
	            name: 'Hombre',
	            data: [42, 39]
	        }, {
	            name: 'Mujer',
	            data: [58, 61]
	        }]
	    });

	    
	    $('#graficoTopProveedores').highcharts({
	        chart: {
	            type: 'column'
	        },
	        title: {
	            text: 'Top Mensual Proveedores'
	        },
	        subtitle: {
	            text: ''
	        },
	        xAxis: {
	            categories: [
	                'Alimentacion Seca',
	                'Frescos'
	            ]
	        },
	        yAxis: {
	            min: 0,
	            title: {
	                text: 'Compras'
	            }
	        },
	        tooltip: {
	            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
	            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
	                '<td style="padding:0"><b>{point.y}</b></td></tr>',
	            footerFormat: '</table>',
	            shared: true,
	            useHTML: true
	        },
	        plotOptions: {
	            column: {
	                pointPadding: 0.2,
	                borderWidth: 0
	            }
	        },
	        series: [{
	            name: 'Proma S.A',
	            data: [4805, 3241],
            	color: '#B40431'

	        }, {
	            name: 'Maersk',
	            data: [8974, 7887]

	        }, {
	            name: 'Tesco',
	            data: [4621, 5625]

	        }, {
	            name: 'Big Stores',
	            data: [4243, 9410]

	        }, {
	            name: 'Store Lands',
	            data: [6100, 5300],
	            color: '#FE9A2E'
	        }]
	    });
	});	
	</script>
{% endblock %}
