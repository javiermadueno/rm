<h4 class="widgettitle">{{ "buscador.segmentos" |trans|title}}</h4>
    <div class="mediamgr_head">
        <form id="formSegmentos" class="form-inline" action="{{ path('direct_search_segmentos')}}" method="post">


            <label class="" for="tipoSegmento">{{ "tipo" | trans|title }}</label>
            <select id="tipoSegmento" name="tipoSegmento" class="tam9 izq">
                <option value="-1" selected>Seleccione</option>
                <option value="2">Compra de Productos</option>
                <option value="3">Habitos de Compra</option>
                <option value="4"> {{ "menu.data.sociodemografico" |trans|title}}</option>
                <option value="5">Ciclo de Vida</option>
                <option value="6">Otras Transformadas</option>
            </select>
            <label class="" for="variable">{{ "Variable" | trans }}</label>
            <select id="variable" name="variable" style="width: 300px"></select>

            <button class="btn btn-primary" name="botonBuscarSegmentos" id="botonBuscarSegmentos">{{ "boton.buscar" | trans }}</button>

        </form>
    </div>

<h4 class="widgettitle">{{ "segmentos" |trans|title}}</h4>
<div class="mediamgr_head">
    <table id="tablaSegmentos" name="tablaSegmentos" class="table table-bordered">
        <thead>
        <tr>
            <th>{{ "" | trans }}</th>
            <th>{{ "segmento" | trans|title }}</th>
            <th>{{ "categoria" | trans|title }}</th>
            <th>{{ "marca" | trans|title }}</th>
            <th>{{ "proveedor" | trans|title }}</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


<script>
    $(document).ready(function(){
        $('#tipoSegmento').change(function(event){
            var msg = $("#formSegmentos").serialize();
            {% set crearUrl = url('direct_search_variables') %}
            var myUrl = '{{crearUrl}}';
            $.ajax({
                type: "POST",
                url: myUrl,
                data: msg,
                complete: function(objeto, exito){
                    if(exito=="success"){

                        $('#variable').children().remove();

                        var resultado = JSON.parse(objeto.responseText);

                        $('#variable').append("<option value= -1>Seleccione</option>");

                        for (var i=0; i<resultado.length; i++) {

                            nombreVariable = resultado[i].nombre;
                            idVariable = resultado[i].idVid || resultado[i].idVt || resultado[i].id;

                            if(typeof idVariable === 'undefined')
                            {
                                idVariable = resultado[i].idVt;
                            }

                            $('#variable').append("<option value="+idVariable+">"+nombreVariable+"</option>");
                        }

                        $('#variable').focus();

                    }
                },
                error: function(objeto, quepaso, otroobj){
                }
            });
        });

        $('#botonBuscarSegmentos').click(function(event){
            event.preventDefault();
            var msg = $("#formSegmentos").serialize();
            {% set crearUrl = url('direct_search_segmentos') %}
            var myUrl = '{{crearUrl}}';
            $.ajax({
                type: "POST",
                url: myUrl,
                data: msg,
                complete: function(objeto, exito){
                    if(exito=="success"){

                        var table = document.getElementById("tablaSegmentos");

                        //Limpio la tabla completa
                        while(table.rows.length > 1) {
                            table.deleteRow(1);
                        }

                        var resultado = JSON.parse(objeto.responseText);

                        if(!resultado.length) {
                            var row = table.insertRow(1);
                            var cell = row.insertCell(0);
                            cell.colSpan = 5;
                            cell.innerHTML = "<div class='alert alert-danger botonera_central'>No se han encontrado segmentos</div>";

                            return;
                        }

                        console.log(resultado);

                        for (var i=0; i<resultado.length; i++) {

                            // Create an empty <tr> element and add it to the 1st position of the table:
                            var row = table.insertRow(i+1);

                            // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
                            var cell0 = row.insertCell(0);
                            var cell1 = row.insertCell(1);
                            var cell2 = row.insertCell(2);
                            var cell3 = row.insertCell(3);
                            var cell4 = row.insertCell(4);

                            var nombre = '' + resultado[i].nombre + '';
                            console.log(nombre);
                            var button = '<button data-id=\''+ resultado[i].cClave +'\'class="btn btn-default" onclick=\'addConsola("'+ nombre +'", event);\'> < </button>';

                            // Add some text to the new cells:
                            cell0.innerHTML = button;
                            cell1.innerHTML = resultado[i].nombre;
                            if(resultado[i].idCategoria != null ){
                                cell2.innerHTML = resultado[i].idCategoria.nombre;
                            }
                            else{
                                cell2.innerHTML = '';
                            }

                            if(cell3.innerHTML = resultado[i].idMarca != null){
                                cell3.innerHTML = resultado[i].idMarca.nombre;
                            }
                            else{
                                cell3.innerHTML = '';
                            }

                            if(resultado[i].idProveedor != null){
                                cell4.innerHTML = resultado[i].idProveedor.nombre;
                            }
                            else{
                                cell4.innerHTML = '';
                            }

                        }
                    }
                },
                error: function(objeto, quepaso, otroobj){
                }
            });
        });
    });
</script>